define(["jquery","core/notification","core/ajax","media_videojs/video-lazy"],function(e,i,n,o){return{init:function(){e(".videoredirect.activity").each(function(){function t(){y--,f.find(".countdown").html(y),y>0?d=setTimeout(t,1e3):(window.location=C,u.removeClass(h),f.find("h5").removeClass(h),m=!0)}function a(){if(y){if(r.length){var e=o.players[p];if(!e)return void setTimeout(a,500)}else if(l.length){if("undefined"==typeof Vimeo)return void setTimeout(a,500);var e=new Vimeo.Player(f.find("iframe"))}e.on("ended",function(){u.addClass(h);var e=n.call([{methodname:"mod_videoredirect_activity_completion",args:{cm:v}}]);e[0].done(function(e){}).fail(i.exception),m||(d=setTimeout(t,1e3))})}}var d,f=e(this),c=f.find(".video-container"),r=f.find(".video-js"),l=f.find(".video-vimeo"),s=f.attr("id"),v=s.replace("module-",""),u=f.find(".notif-next-video"),m=!1,h="active",y=c.data("secondsToGo"),C=c.data("url");if(r.length)var p=r.attr("id");else if(l.length){f.find("iframe")}a(),f.find(".button.cancel").click(function(e){e.preventDefault(),clearTimeout(d),u.removeClass(h),f.find("h5").removeClass(h),m=!0}),f.find(".button:not(.cancel)").click(function(e){u.removeClass(h),f.find("h5").removeClass(h),m=!0})})}}});